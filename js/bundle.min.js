var hideOnScroll=true;document.addEventListener('DOMContentLoaded',function(){disableHideOnScroll(2);var note=getCurrentNote();if(note){note.opacity=0;}
window.setTimeout(function(){setupNote();if(note){note.opacity=1;}},500);var observer=new IntersectionObserver(endnoteIntersectionCallback);var endnotes=document.querySelector('.footnotes');observer.observe(endnotes);});window.addEventListener('hashchange',function(){setupNote();},false);window.addEventListener('scroll',function(){if(location.hash.startsWith('#fn:')&&hideOnScroll){closeNote(getCurrentNote());}});window.addEventListener('touchend',function(event){if(event.target.classList.contains('footnote-ref')){disableHideOnScroll(0.5);event.preventDefault();event.stopPropagation();event.target.click();}});function endnoteIntersectionCallback(entries,observer){entries.forEach(entry=>{var elem=entry.target;if(entry.isIntersecting){elem.classList.add('endnotes');var notes=elem.getElementsByTagName('li');Array.prototype.forEach.call(notes,function(li){li.removeAttribute('style');li.classList.remove('flip');});}else{elem.classList.remove('endnotes');}})}
function getCurrentNote(){if(location.hash.startsWith('#fn:')){return document.getElementById(location.hash.slice(1));}}
function setupNote(){var note=getCurrentNote();if(note){positionContextualNote(note);var backref=note.getElementsByClassName('footnote-backref').item(0);backref.addEventListener('click',noteCloseLinkHandler);}}
function closeNote(note){location.hash='#-';var backref=note.getElementsByClassName('footnote-backref').item(0);this.removeEventListener('click',noteCloseLinkHandler);}
function disableHideOnScroll(seconds){hideOnScroll=false;window.setTimeout(function(){hideOnScroll=true;},seconds*1000);}
function noteCloseLinkHandler(){var note=this.parentNode.parentNode;if(location.hash=='#'+note.getAttribute('id')){event.preventDefault();event.stopPropagation();}
closeNote(note);}
function positionContextualNote(note){let mql=window.matchMedia('(min-width: 414px)');if(!mql.matches){return;}
var backref=note.getElementsByClassName('footnote-backref').item(0);var ref=document.getElementById(backref.getAttribute('href').slice(1));var refLocation=ref.getBoundingClientRect();var noteTop=refLocation.top+refLocation.height+5+'px';note.style.top=refLocation.top+refLocation.height+5+'px';var noteLeft;if(refLocation.left<(note.clientWidth-70)){noteLeft=refLocation.left+refLocation.width/2-70;note.classList.add('flip');}else{noteLeft=refLocation.left+refLocation.width/2-note.clientWidth+70;}
note.style.left=noteLeft+'px'
note.style.bottom='auto';var noteLocation=note.getBoundingClientRect();if(noteLocation.bottom>document.documentElement.clientHeight){disableHideOnScroll(1);var adjustment=noteLocation.bottom-document.documentElement.clientHeight+10;window.scrollBy(0,adjustment);note.style.top=noteLocation.top-adjustment+'px';}}